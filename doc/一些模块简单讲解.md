### co-views 的用法

co-views 其实是对通用模板引擎渲染平台 consolidate 的封装，
consolidate 应该算是 express.js 时代非常重要的一个库，它支持包括 ejs, mustache, swig 等各种模板渲染并提供统一的 api 调用方法。
根据对 co-views 源码的分析，它把 consolidate 统一的 api 又封装成了 return function (done) {...} 的形态，这样源代码中的 yield render(view, model) 就能够融入 generator 的逻辑之中。

值得一提的是，源代码中 yield render(view, model) 这里的 model 传入了一个 {cache: false} 的参数，这会意味着模板不会被缓存，每次修改模板文件之后，在不重启服务的情况下，
刷新页面就可以看到最新的效果。这个选项是针对开发环境设置的，为了保障线上环境的运行性能和效率，这个选项应该是不需要的。

## log4js

### 简单介绍

log4js.json 配置文件，参考 [log4js-wiki](https://github.com/nomiddlename/log4js-node/wiki/Appenders)

    {   
      "appenders": [   
      // 下面一行应该是用于跟express配合输出web请求url日志的  
      {"type": "console", "category": "console"},   
      // 定义一个日志记录器  
      {        
        "type": "dateFile",                 // 日志文件类型，可以使用日期作为文件名的占位符  
        "filename": "e:/weblogs/logs/",     // 日志文件名，可以设置相对路径或绝对路径  
        "pattern": "debug/yyyyMMddhh.txt",  // 占位符，紧跟在filename后面  
        "absolute": true,                   // filename是否绝对路径  
        "alwaysIncludePattern": true,       // 文件名是否始终包含占位符  
        "category": "logInfo"               // 记录器名  
      } ],  
      "levels":{ "logInfo": "DEBUG"}        // 设置记录器的默认显示级别，低于这个级别的日志，不会输出  
    }

代码调用

    var logger = require("./index");  
    logger.writeInfo("哈哈1开始记录日志");  
    logger.writeErr("出错了，你怎么搞的"); 
    
 express 
    
    var connect = require('connect');
    var eventproxy = require('eventproxy');
    var tair = require('./common/tair');
    var app = connect();
    // TODO: add render
    app.use(function (req, res, next) {
      var ep = eventproxy.create();
      ep.fail(next);
      // 并发取 k1, k2
      tair.get('k1', ep.done('v1'));
      tair.get('k2', ep.done('v2'));
      tair.on('v1', function (v1) {
        // k1 取完接着取 k3
        if (v1) {
          return tair.get('k3', ep.done('v3'));
        }
        ep.emit('v3');
      });
      ep.all('v1', 'v2', 'v3', function (v1, v2, v3) {
        res.render('home.html', {
          v1: v1,
          v2: v2,
          v3: v3
        });
      });
    });
    
koa    
    
     tair.get = thunkfiy(tair.get);
     var app = koa();
     // TODO: add render
     app.use(function *(next) {
       var ep = eventproxy.create();
       ep.fail(next);
       // 并发取 k1, k2
       var rs = yield [tair.get('k1'), tair.get('k2')];
       var v1 = rs[0];
       var v2 = rs[1];
       var v3 = null;
       if (v1) {
         // k1 取完接着取 k3
         v3 = yield tair.get('k3');
       }
       yield this.render('home.html', {
         v1: v1,
         v2: v2,
         v3: v3
       });
     });
    